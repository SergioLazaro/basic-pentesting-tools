__author__ = 'sergio'

import optparse, os

def main(file, dir):
    if os.path.isdir(dir) and os.path.isfile(file):
        dir = fix_dir(dir)
        with open(file) as f:
            print "[*] Running bruteforce..."
            brute_force_dir(f, dir)

    else:
        print "[!!] Error: a directory and file are needed"
        print "[!!] Exiting..."
        exit(1)

def brute_force_dir(file, dir):

    users = ['a.modlin','e.lindsey', 'g.leone', 'm.howard', 'rross', 's.locklear']
    #Iter over file
    count = 0
    for line in file:
        if line.rstrip() is not '':
            try_each_user(users, line.rstrip(), dir)
        count += 1

    print "[*] Number of attempts: " + str(count)

def try_each_user(users, line, dir):
    line = line.rstrip()

    for user in users:
        path = dir + user + '/' + line + '/'  # Build path
        if os.path.isdir(path):
            print "[*] Found one match: " + path

def fix_dir(dir):
    if not dir.endswith('/'):
        dir += '/'
    return dir

def print_help(parser):
    print "arguments error!!\n"
    parser.print_help()
    exit(-1)

if __name__ == "__main__":

    parser = optparse.OptionParser()
    parser.add_option('-f', '--file', action="store", help="File path with directory names", dest="file",type="string")
    parser.add_option('-d','--dir', action="store", help="Directory to bruteforce", dest="dir",type="string")

    (opts, args) = parser.parse_args()
    if opts.file is not None and opts.dir is not None:
        main(opts.file, opts.dir)
    else:
        print_help(parser)