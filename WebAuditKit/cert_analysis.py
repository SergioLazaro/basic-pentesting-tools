import os
import subprocess

class cert_analysis:

    def __init__(self, host, port_list, working_dir, sslscan_path):
        self.host = host
        self.port_list = port_list
        self.working_dir = working_dir
        self.sslscan_path = sslscan_path
        go = self.check_ssl()
        if go:
            self.start_analysis()


    def check_ssl(self):
        if os.path.isdir(self.sslscan_path):
            for port in self.port_list:
                if port[1] == '443':
                    return True
            print "[!!] Port 443 not found"
        else:
            print "[!!] SSLScan path should be a directory."

    '''
        Method that launchs SSLScan in a subprocess, read the output and write a file inside
        the working directory. SSLScan should be installed.
    '''
    def start_analysis(self):
        p = subprocess.Popen([self.sslscan_path + "sslscan", self.host], stdout=subprocess.PIPE)
        file = open(self.working_dir + "sslscan.txt", "w")
        file.write("\tSSLScan Results\n")
        file.write("======================================================\n")
        while True:
            line = p.stdout.readline()
            if line == '':
                break

            file.write(line)

        file.close()